<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Банковское приложение: Главная</title>
</head>

<body>

<form method="post" action="/logout" style="float:right; display:inline; margin-left: 20px;">
    <button type="submit" style="background:none; border:none; color:blue; cursor:pointer; padding:0; font:inherit;">
        <b>ВЫЙТИ &cudarrr;</b>
    </button>
</form>
<h1 style="text-align: center;">Личный кабинет: <span th:text="${login}"></span></h1>

<table style="width:70%;margin-left:auto;margin-right:auto;">

    <tr><td style="padding:5px;">
        <h2 style="margin-top:0;"> Настройки аккаунта</h2>

        <form method="post" th:action="${'/api/users/' + login + '/password'}" style="margin-bottom: 10px;">
            <table style="width:100%; ... background-color:#f0f0f0;">
                <tr>
                    <td style="font-weight:bold; width: 30%;">Логин</td>
                    <td colspan="3" th:text="${login} ?: 'Не указан'"></td>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Изменить пароль</td>
                    <td colspan="3">
                        <p style="color:red;" th:if="${passwordErrors != null}"
                           th:each="passwordError : ${passwordErrors}"
                           th:text="${passwordError}"></p>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            Пароль: <input name="password" type="password" required/>
                            Повторите: <input name="confirm_password" type="password" required/>
                            <button>Изменить</button>
                        </div>
                    </td>
                </tr>
            </table>
        </form>

        <form th:action="${'/api/users/' + login}" method="post" style="text-align: right; margin-bottom: 15px;">
            <input type="hidden" name="_method" value="DELETE" />
            <button type="submit" onclick="return confirm('Вы уверены, что хотите удалить аккаунт? Убедитесь, что на всех счетах 0.00!')"
                    style="color:red; background:none; border: 1px solid red; cursor:pointer; padding: 5px 10px;">
                Удалить аккаунт
            </button>
        </form>

        <form method="post" th:action="${'/api/users/' + login + '/profile'}">
        </form>

        <form method="post" th:action="${'/api/users/' + login + '/profile'}">
            <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:#f0f0f0;">
                <tr th:if="${userAccountsErrors != null}" th:each="userAccountsError : ${userAccountsErrors}">
                    <td style="color:red;" colspan="3" th:text="${userAccountsError}"></td>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Фамилия Имя</td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <input name="lastName" type="text" placeholder="Фамилия" style="width:50%" th:value="${lastName} ?: ''" required/>
                            <input name="firstName" type="text" placeholder="Имя" style="width:50%" th:value="${firstName} ?: ''" required/>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Дата рождения</td>
                    <td>
                        <input name="birthdate" type="date" style="width:100%" th:value="${birthdate}" required/>
                    </td>
                </tr>

                <tr>
                    <td style="text-align:right" colspan="2">
                        <button>Сохранить изменения</button>
                    </td>
                </tr>
            </table>
        </form>
    </td></tr>

    <tr>
        <td colspan="1" style="padding: 0; height: 10px;">
            <hr style="border: 0; border-top: 1px solid #ccc; margin: 0;"/>
        </td>
    </tr>

    <tr><td style="padding:5px;">
        <h2>Текущий баланс</h2>
        <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:#e6e6e6;">
            <tr><th>Валюта</th><th>Баланс</th></tr>
            <th:block th:if="${not #lists.isEmpty(accounts)}">
                <tr th:each="account : ${accounts}" th:if="${account != null and account.currency != null}">
                    <td style="font-weight:bold;" th:text="${account.currency} ?: 'Валюта'">Валюта</td>
                    <td th:text="${account.balance} ?: '0.00'">0.00</td>
                </tr>
            </th:block>
            <tr th:if="${#lists.isEmpty(accounts)}">
                <td colspan="2" style="text-align:center; color: gray;">
                    Счета не найдены
                </td>
            </tr>
        </table>
    </td></tr>

    <tr>
        <td colspan="1" style="padding: 0; height: 10px;">
            <hr style="border: 0; border-top: 1px solid #ccc; margin: 0;"/>
        </td>
    </tr>

    <tr><td style="padding:5px;">
        <h2>Внесение / Снятие денег</h2>
        <form method="post" th:action="${'/user/' + login + '/cash'}">
            <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:#d9d9d9;">
                <tr th:if="${cashErrors != null}" th:each="cashError : ${cashErrors}">
                    <td style="color:red;" colspan="4" th:text="${cashError}"></td>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Операция</td>
                    <td>
                        Валюта счета
                        <select name="currency" required>
                            <option th:each="account : ${accounts}"
                                    th:value="${account.currency}"
                                    th:text="${account.currency + ' (' + account.balance + ')'}"></option>
                        </select>
                    </td>
                    <td>
                        <input name="value" type="number" placeholder="Сумма" style="width:100%" required min="0.01" step="0.01"/>
                    </td>
                    <td style="text-align:right">
                        <button name="action" value="PUT" style="background-color: lightgreen;">Положить</button>
                        <button name="action" value="GET" style="background-color: salmon;">Снять</button>
                    </td>
                </tr>
            </table>
        </form>
    </td></tr>

    <tr>
        <td colspan="1" style="padding: 0; height: 10px;">
            <hr style="border: 0; border-top: 1px solid #ccc; margin: 0;"/>
        </td>
    </tr>

    <tr><td style="padding:5px;">
        <h2>Перевод другому аккаунту</h2>
        <form method="post" th:action="${'/user/' + login + '/transfer'}">
            <table style="width:100%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:#cccccc;">
                <tr th:if="${transferOtherErrors != null}" th:each="transferOtherError : ${transferOtherErrors}">
                    <td style="color:red;" colspan="5" th:text="${transferOtherError}"></td>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Перевод</td>
                    <td>
                        Со счета (Валюта)
                        <select name="from_currency" required>
                            <option th:each="account : ${accounts}"
                                    th:value="${account.currency}"
                                    th:text="${account.currency + ' (' + account.balance + ')'}"></option>
                        </select>
                    </td>
                    <td>
                        Сумма
                        <input name="value" type="number" placeholder="Сумма перевода" required min="0.01" step="0.01"/>
                    </td>
                    <td>
                        Кому (Логин)
                        <input name="to_login" type="text" placeholder="Логин получателя" required/>
                    </td>
                    <td style="text-align:right">
                        <button>Перевести</button>
                    </td>
                </tr>
            </table>
        </form>
    </td></tr>
</table>
</body>
</html>